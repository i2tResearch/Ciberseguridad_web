---
title: "Traffic Android Malware Analysis"
author: "Christian Urcuqui"
date: "5 de enero de 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Dataset Analysis


```{r android}
data  <- read.table(file.choose(),sep=";", header = TRUE)
summary(data) 

```

```{r android}
new_data <- data[,-c(6, 7,12,13,14)]
#install.packages("Hmisc")
#install.packages("corrplot")
library(Hmisc)
library(ggplot2)
library(corrplot)

p <- cor(new_data[,-c(1,12)])
cat("Correlación de Pearson\n")
print(p)


```

De estos indicadores podemos intuir que las variables: tcp_packets, vulume_bytes, source_app_packets, remote_app_packets,
source_app_bytes, remote_app_bytes y source_app_packets.1 son las más relacionadas unas con otras.       


## Models process making



```{r model}
#install.packages("caret")
#install.packages("DAAG")

library(DAAG)
library(caret)
library(e1071)
set.seed(1234)

# resultados de datos viejos con anova
#tcp_packets           1  115.227      6275     8335.5 < 2.2e-16 ***
#vulume_bytes          1    4.314      6274     8331.2    0.0378 *  
#source_app_packets    1    2.665      6273     8328.6    0.1026    
#remote_app_packets    1   33.160      6272     8295.4 8.486e-09 ***
#source_app_bytes      1   70.789      6271     8224.6 < 2.2e-16 ***
#remote_app_bytes      1  105.447      6270     8119.2 < 2.2e-16 ***
#source_app_packets.1  0    0.000      6270     8119.2          



data_filter <- new_data[,-c(1,3,4,11)]
# Utilizando estos datos se obtienen los siguientes resultados 
partition <- createDataPartition(data_filter$type, p=0.8, list=FALSE)
training <- data_filter[partition,]
testing <- data_filter[-partition,]
  
  
train_control<- trainControl(method = "cv", number = 10)
modl<- train(type~.,data=training, trControl= train_control, method="glm", family= binomial() )
modl

confusionMatrix(modl)


```
## NAIVE BAYES
NAIVE BAYES

```{r models evaluation}
tune.control <- tune.control(random=F,nrepeat=5,
                             sampling=c("cross"),sampling.aggregate=mean, cross=10,
                             best.model=T, performances=T)

model <- naiveBayes(type ~., training, tune.control) 
pred <- predict(model, data_filter) 

confusionMatrix(pred, data_filter$type)

```
## J48
```{r models evaluation}

library(caTools)

library(RWeka)


trainJ <- createFolds(training$type, k=5)

C45Fit <- train(type ~ ., method = "J48", data = training,
                tuneLength = 5,
                trControl = trainControl(
                  method = "cv"))
C45Fit

confusionMatrix(C45Fit)


C45Fit

confusionMatrix(pred, entrenamiento$clasificacion)



```




## SVM
```{r, echo=TRUE, warning=FALSE, error=FALSE, message=FALSE}

train_i <- createFolds(training$type, k=10)
svmFit <- train(type ~., method = "svmLinear", data = training, tuneLength = 10,trControl = trainControl(method = "cv", indexOut = train_i))
svmFit

confusionMatrix(svmFit)

#Tiempo ejecucion en segundos
proc.time() - ptm
```

## Neural Network
```{r, echo=TRUE, warning=FALSE, error=FALSE, message=FALSE}


nnFit <- train(type ~., method = "elm", data = training, tuneLength = 10,trControl = trainControl(method = "cv", indexOut = train_i))
nnFit

confusionMatrix(nnFit)

```